<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <title>Sklep — ProLevel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Sklep ProLevel — przeglądaj wszystkie kursy online.">
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/css/a11y.css">
  <link rel="stylesheet" href="/cookie-consent.css">
  <script>window.GA_MEASUREMENT_ID="G-XXXXXXX";</script>
  <script src="/js/cookie-consent.js" defer></script>
  </head>
<body>

  <header class="header">
    <div class="container header-inner">
      <a class="brand" href="../index.html">
        <div class="brand__logo"></div>
        <div class="brand__name">ProLevel</div>
      </a>
      <nav class="nav">
        <a class="btn btn--ghost" href="/sklep.html" aria-current="page">Sklep</a>
        <a class="btn btn--ghost" href="/kalkulatory.html">Kalkulatory</a>
        <a class="btn btn--ghost" href="/klubtrenera.html">Klub Trenera</a>
        <a data-auth="guest" class="btn" href="/logowanie.html">Zaloguj</a>
        <a data-auth="user" class="btn btn--ghost hide" href="/panel.html">Moje kursy</a>
        <button data-auth="user" data-action="logout" class="btn hide">Wyloguj</button>
      </nav>
      <button id="hamburger" class="hamburger">☰</button>
    </div>
    <div id="mobile" class="mobile">
      <div class="container nav-col">
        <a href="/sklep.html" class="btn btn--ghost">Sklep</a>
        <a href="/kalkulatory.html" class="btn btn--ghost">Kalkulatory</a>
        <a href="/klubtrenera.html" class="btn btn--ghost">Klub Trenera</a>
        <a data-auth="guest" href="/logowanie.html" class="btn">Zaloguj</a>
        <a data-auth="user" href="/panel.html" class="btn btn--ghost hide">Moje kursy</a>
        <button data-auth="user" data-action="logout" class="btn hide">Wyloguj</button>
      </div>
    </div>
  </header>

  <main class="section">
    <div class="container">
      <div class="section__head">
        <h1 class="section__title">Sklep</h1>
        <p class="section__desc">Wszystkie dostępne kursy</p>
      </div>

      <div class="hero-card" style="margin-bottom:18px;">
        <div class="grid-2">
          <input id="q" class="input" type="search" placeholder="Szukaj kursu… (tytuł, opis)">
          <div style="display:flex; gap:10px; justify-content:flex-end;">
            <button id="btnReset" class="btn btn--ghost">Wyczyść</button>
          </div>
        </div>
      </div>

      <div id="list" class="cards" aria-live="polite"></div>
    </div>
  </main>
  <section class="shop">
    <div id="shop-status" class="shop-status" style="display:none"></div>
    <div id="shop-grid" class="shop-grid"></div>
  </section>
  <script src="/js/shop.js" defer></script>
  
  <footer class="footer">
    <div class="container footer-inner">
      <div>© <span id="year"></span> ProLevel</div>
      <div style="display:flex; gap:16px;">
        <a href="/regulamin.html">Regulamin</a>
        <a href="/polityka.html">Polityka prywatności</a>
        <a href="/kontakt.html">Kontakt</a>
      </div>
    </div>
  </footer>

  <div id="toast" class="toast"></div>
  <script src="/js/app.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const input = document.getElementById('q');
    const btnReset = document.getElementById('btnReset');
    const list = document.getElementById('list');

    let items = [];
    let filtered = [];

    function render(data){
      list.innerHTML = '';
      if(data.length === 0){
        list.innerHTML = '<p class="card__desc">Nie znaleziono kursów dla podanego filtra.</p>';
        return;
      }
      for(const it of data){
        const el = document.createElement('article');
        el.className = 'card';
        el.innerHTML = `
          <div class="card__media" ${it.thumbnail_url ? `style="background:url('${it.thumbnail_url}') center/cover no-repeat"` : ''}></div>
          <div class="card__body">
            <h3 class="card__title">${escapeHtml(it.title)}</h3>
            <p class="card__desc">${escapeHtml(it.description || '')}</p>
            <div class="card__meta">
              <span class="price">${formatPrice(it.price_cents)}</span>
              <a class="btn" href="/kurs.html?id=${encodeURIComponent(it.id)}">Szczegóły</a>
            </div>
          </div>
        `;
        list.appendChild(el);
      }
    }

    function applyFilter(){
      const q = (input.value || '').trim().toLowerCase();
      filtered = !q ? items : items.filter(it =>
        (it.title||'').toLowerCase().includes(q) ||
        (it.description||'').toLowerCase().includes(q)
      );
      render(filtered);
    }

    function formatPrice(cents){
      if(typeof cents !== 'number') return '—';
      return (cents/100).toLocaleString('pl-PL',{style:'currency',currency:'PLN'});
    }
    function escapeHtml(s){
      return String(s)
        .replaceAll('&','&amp;').replaceAll('<','&lt;')
        .replaceAll('>','&gt;').replaceAll('"','&quot;')
        .replaceAll("'","&#39;");
    }

    async function load(){
      try{
        const data = await APP.api('/catalog');
        items = data.items || [];
        filtered = items;
        render(filtered);
      }catch(e){
        list.innerHTML = '<p class="card__desc">Błąd pobierania katalogu.</p>';
      }
    }

    input.addEventListener('input', applyFilter);
    btnReset.addEventListener('click', ()=>{ input.value=''; applyFilter(); });
    load();
  </script>
</body>
</html>
